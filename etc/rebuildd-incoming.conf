author 'Felix Lange <fl@travelping.com>'
description 'Starts and supervises the rebuildd-incoming daemon through upstart' 

start on started rebuildd
stop on stopping rebuildd

respawn
respawn limit 20 10

env TELNET_PORT=9999
env CLI_PORT=9997
env INCOMING_DIR=/usr/src/disk/debian-package-build/incoming
env WORKING_DIR=/usr/src/disk/debian-package-build/working_dir
env REPO_DIR=/usr/src/disk/debian-package-build/repo
env TMP_REPO_DIR="/usr/src/disk/debian-package-build/tmp-repo"
env DISTS="lucid maverick natty oneiric"
env ARCH="amd64"
env INSCRIPT="/usr/src/disk/debian-package-build/scripts/run-reprepro"

exec /usr/local/bin/rebuildd-incoming --input-dir "$INCOMING_DIR" --output-dir "$WORKING_DIR" --repo-dir "$REPO_DIR" --tmp-repo-dir "$TMP_REPO_DIR" --incoming-script "$INSCRIPT" --dists "$DISTS" --arch "$ARCH" --rbport "$TELNET_PORT" --cport "$CLI_PORT" 2>&1 | logger -p daemon.info -t rebuildd-incoming
